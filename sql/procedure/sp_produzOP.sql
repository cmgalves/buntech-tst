SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER procedure [dbo].[sp_produzOP]
	@FILIAL VARCHAR(3),
	@OP VARCHAR(11),
	@QTDE FLOAT,
	@TIPO VARCHAR(1)
AS
--sp_ajusta_OP '101', '00275101001', 'PAN00090', 'ALP 10 ORANGE F 7 DRUM 40KG', 'PAN0067133', 'MEN00165', 'PALLET PBR MADEIRA NOVO DUPLA FACE 1,00X1,20', 'R', 'C', 'UN', 12
--EXEC    sp_ajusta_OP   '101',   '00275101001',   'PAN00090',   'undefined',   'PA001432',   'GAS311202',   'GAS EXPANSAO - CG',   'E',   'C',   'M3',   86.176,   0

--SELECT * FROM PCP..OP WHERE OP = '00236901001'
IF @TIPO = 'P'
	BEGIN
		UPDATE 
			PCP..OP
		SET
			ENTREGUE = ENTREGUE + @QTDE,
			SITUACA = 'P'
		WHERE 
			1 = 1
			AND FILIAL = @FILIAL
			AND OP = @OP
	END
	
IF @TIPO = 'T'
	BEGIN
		UPDATE 
			PCP..OP
		SET
			ENTREGUE = QTDEPCF,
			SITUACA = 'T'
		WHERE 
			1 = 1
			AND FILIAL = @FILIAL
			AND OP = @OP
	END
	
GO
